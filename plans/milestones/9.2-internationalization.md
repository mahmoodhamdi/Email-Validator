# Milestone 9.2: Internationalization (i18n)

> **Phase:** 9 - User Experience
> **Status:** NOT STARTED
> **Priority:** MEDIUM
> **Complexity:** Medium
> **Estimated Time:** 5-6 hours

---

## Prompt for Claude Code

```
You are working on the Email Validator project. Your task is to implement internationalization with Arabic and English support.

IMPORTANT INSTRUCTIONS:
1. Read this entire file before starting
2. Follow the implementation steps in order
3. Write comprehensive tests
4. Update the checklist as you complete each task
5. Commit with message: "feat: add internationalization with Arabic/English support"
6. Push the changes

PROJECT CONTEXT:
- This is a Next.js 14 application with App Router
- Needs RTL support for Arabic
- Use next-intl for translations
- Persist language preference
```

---

## Objective

Implement full internationalization support:
- Arabic and English languages
- RTL layout support for Arabic
- Persisted language preference
- Language switcher component
- All UI text translated

---

## Implementation Steps

### Step 1: Install Dependencies

```bash
npm install next-intl
```

### Step 2: Create Translation Files

Create `messages/en.json`:

```json
{
  "common": {
    "appName": "Email Validator",
    "loading": "Loading...",
    "error": "Error",
    "success": "Success",
    "cancel": "Cancel",
    "save": "Save",
    "delete": "Delete",
    "edit": "Edit",
    "close": "Close",
    "back": "Back",
    "next": "Next",
    "submit": "Submit",
    "clear": "Clear",
    "copy": "Copy",
    "copied": "Copied!",
    "download": "Download",
    "upload": "Upload"
  },
  "nav": {
    "home": "Home",
    "bulk": "Bulk Validation",
    "history": "History",
    "apiDocs": "API Docs",
    "settings": "Settings"
  },
  "home": {
    "title": "Email Validator",
    "subtitle": "Validate email addresses with comprehensive checks",
    "placeholder": "Enter email address",
    "validateButton": "Validate",
    "validating": "Validating..."
  },
  "validation": {
    "valid": "Valid",
    "invalid": "Invalid",
    "risky": "Risky",
    "unknown": "Unknown",
    "score": "Score",
    "deliverability": "Deliverability",
    "risk": "Risk Level",
    "checks": "Validation Checks",
    "syntax": "Syntax",
    "domain": "Domain",
    "mx": "MX Records",
    "disposable": "Disposable",
    "roleBased": "Role-Based",
    "freeProvider": "Free Provider",
    "typoSuggestion": "Did you mean {suggestion}?"
  },
  "bulk": {
    "title": "Bulk Email Validation",
    "subtitle": "Validate multiple email addresses at once",
    "uploadFile": "Upload File",
    "pasteEmails": "Or paste emails",
    "placeholder": "Enter emails (one per line)",
    "validateAll": "Validate All",
    "processing": "Processing {current} of {total}...",
    "complete": "Validation Complete",
    "summary": "Summary",
    "totalEmails": "Total Emails",
    "validEmails": "Valid",
    "invalidEmails": "Invalid",
    "riskyEmails": "Risky",
    "exportResults": "Export Results",
    "exportCSV": "Export as CSV",
    "exportJSON": "Export as JSON"
  },
  "history": {
    "title": "Validation History",
    "subtitle": "View your recent email validations",
    "noHistory": "No validation history yet",
    "clearHistory": "Clear History",
    "confirmClear": "Are you sure you want to clear all history?",
    "validatedAt": "Validated at"
  },
  "apiDocs": {
    "title": "API Documentation",
    "subtitle": "Integrate email validation into your applications",
    "endpoint": "Endpoint",
    "method": "Method",
    "request": "Request",
    "response": "Response",
    "tryIt": "Try It",
    "authentication": "Authentication",
    "rateLimit": "Rate Limit"
  },
  "settings": {
    "title": "Settings",
    "language": "Language",
    "theme": "Theme",
    "light": "Light",
    "dark": "Dark",
    "system": "System"
  },
  "errors": {
    "required": "This field is required",
    "invalidEmail": "Please enter a valid email address",
    "networkError": "Network error. Please try again.",
    "serverError": "Server error. Please try again later.",
    "rateLimited": "Too many requests. Please wait."
  },
  "footer": {
    "copyright": "© {year} Email Validator. All rights reserved.",
    "privacy": "Privacy Policy",
    "terms": "Terms of Service"
  }
}
```

Create `messages/ar.json`:

```json
{
  "common": {
    "appName": "مدقق البريد الإلكتروني",
    "loading": "جاري التحميل...",
    "error": "خطأ",
    "success": "نجاح",
    "cancel": "إلغاء",
    "save": "حفظ",
    "delete": "حذف",
    "edit": "تعديل",
    "close": "إغلاق",
    "back": "رجوع",
    "next": "التالي",
    "submit": "إرسال",
    "clear": "مسح",
    "copy": "نسخ",
    "copied": "تم النسخ!",
    "download": "تحميل",
    "upload": "رفع"
  },
  "nav": {
    "home": "الرئيسية",
    "bulk": "التحقق الجماعي",
    "history": "السجل",
    "apiDocs": "وثائق API",
    "settings": "الإعدادات"
  },
  "home": {
    "title": "مدقق البريد الإلكتروني",
    "subtitle": "تحقق من عناوين البريد الإلكتروني بفحوصات شاملة",
    "placeholder": "أدخل عنوان البريد الإلكتروني",
    "validateButton": "تحقق",
    "validating": "جاري التحقق..."
  },
  "validation": {
    "valid": "صالح",
    "invalid": "غير صالح",
    "risky": "محفوف بالمخاطر",
    "unknown": "غير معروف",
    "score": "النتيجة",
    "deliverability": "قابلية التسليم",
    "risk": "مستوى المخاطر",
    "checks": "فحوصات التحقق",
    "syntax": "الصيغة",
    "domain": "النطاق",
    "mx": "سجلات MX",
    "disposable": "مؤقت",
    "roleBased": "دور وظيفي",
    "freeProvider": "مزود مجاني",
    "typoSuggestion": "هل تقصد {suggestion}؟"
  },
  "bulk": {
    "title": "التحقق الجماعي من البريد الإلكتروني",
    "subtitle": "تحقق من عناوين بريد إلكتروني متعددة دفعة واحدة",
    "uploadFile": "رفع ملف",
    "pasteEmails": "أو الصق العناوين",
    "placeholder": "أدخل العناوين (واحد في كل سطر)",
    "validateAll": "تحقق من الكل",
    "processing": "جاري معالجة {current} من {total}...",
    "complete": "اكتمل التحقق",
    "summary": "الملخص",
    "totalEmails": "إجمالي العناوين",
    "validEmails": "صالح",
    "invalidEmails": "غير صالح",
    "riskyEmails": "محفوف بالمخاطر",
    "exportResults": "تصدير النتائج",
    "exportCSV": "تصدير كـ CSV",
    "exportJSON": "تصدير كـ JSON"
  },
  "history": {
    "title": "سجل التحقق",
    "subtitle": "عرض عمليات التحقق الأخيرة",
    "noHistory": "لا يوجد سجل تحقق بعد",
    "clearHistory": "مسح السجل",
    "confirmClear": "هل أنت متأكد من مسح كل السجل؟",
    "validatedAt": "تم التحقق في"
  },
  "apiDocs": {
    "title": "وثائق API",
    "subtitle": "دمج التحقق من البريد الإلكتروني في تطبيقاتك",
    "endpoint": "نقطة النهاية",
    "method": "الطريقة",
    "request": "الطلب",
    "response": "الاستجابة",
    "tryIt": "جربه",
    "authentication": "المصادقة",
    "rateLimit": "حد الطلبات"
  },
  "settings": {
    "title": "الإعدادات",
    "language": "اللغة",
    "theme": "المظهر",
    "light": "فاتح",
    "dark": "داكن",
    "system": "النظام"
  },
  "errors": {
    "required": "هذا الحقل مطلوب",
    "invalidEmail": "يرجى إدخال عنوان بريد إلكتروني صالح",
    "networkError": "خطأ في الشبكة. يرجى المحاولة مرة أخرى.",
    "serverError": "خطأ في الخادم. يرجى المحاولة لاحقاً.",
    "rateLimited": "طلبات كثيرة جداً. يرجى الانتظار."
  },
  "footer": {
    "copyright": "© {year} مدقق البريد الإلكتروني. جميع الحقوق محفوظة.",
    "privacy": "سياسة الخصوصية",
    "terms": "شروط الخدمة"
  }
}
```

### Step 3: Configure next-intl

Create `src/i18n.ts`:

```typescript
import { getRequestConfig } from 'next-intl/server';
import { cookies } from 'next/headers';

export const locales = ['en', 'ar'] as const;
export type Locale = (typeof locales)[number];
export const defaultLocale: Locale = 'en';

export default getRequestConfig(async () => {
  const cookieStore = cookies();
  const locale = (cookieStore.get('locale')?.value as Locale) || defaultLocale;

  return {
    locale,
    messages: (await import(`../messages/${locale}.json`)).default,
  };
});
```

Create `src/middleware.ts`:

```typescript
import createMiddleware from 'next-intl/middleware';
import { locales, defaultLocale } from './i18n';

export default createMiddleware({
  locales,
  defaultLocale,
  localePrefix: 'as-needed',
});

export const config = {
  matcher: ['/((?!api|_next|_vercel|.*\\..*).*)'],
};
```

### Step 4: Create Language Provider

Create `src/components/providers/LanguageProvider.tsx`:

```typescript
'use client';

import { NextIntlClientProvider } from 'next-intl';
import { ReactNode } from 'react';

interface LanguageProviderProps {
  children: ReactNode;
  locale: string;
  messages: Record<string, unknown>;
}

export function LanguageProvider({ children, locale, messages }: LanguageProviderProps) {
  return (
    <NextIntlClientProvider locale={locale} messages={messages}>
      {children}
    </NextIntlClientProvider>
  );
}
```

### Step 5: Create Language Switcher

Create `src/components/language/LanguageSwitcher.tsx`:

```typescript
'use client';

import { useLocale } from 'next-intl';
import { useRouter } from 'next/navigation';
import { useTransition } from 'react';
import { Button } from '@/components/ui/button';
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuTrigger,
} from '@/components/ui/dropdown-menu';
import { Globe } from 'lucide-react';
import { Locale, locales } from '@/i18n';

const languageNames: Record<Locale, string> = {
  en: 'English',
  ar: 'العربية',
};

export function LanguageSwitcher() {
  const locale = useLocale() as Locale;
  const router = useRouter();
  const [isPending, startTransition] = useTransition();

  const handleLocaleChange = (newLocale: Locale) => {
    // Set cookie
    document.cookie = `locale=${newLocale};path=/;max-age=31536000`;

    startTransition(() => {
      router.refresh();
    });
  };

  return (
    <DropdownMenu>
      <DropdownMenuTrigger asChild>
        <Button variant="ghost" size="icon" disabled={isPending}>
          <Globe className="h-5 w-5" />
          <span className="sr-only">Switch language</span>
        </Button>
      </DropdownMenuTrigger>
      <DropdownMenuContent align="end">
        {locales.map((loc) => (
          <DropdownMenuItem
            key={loc}
            onClick={() => handleLocaleChange(loc)}
            className={locale === loc ? 'bg-accent' : ''}
          >
            {languageNames[loc]}
          </DropdownMenuItem>
        ))}
      </DropdownMenuContent>
    </DropdownMenu>
  );
}
```

### Step 6: Create RTL Support

Create `src/components/providers/DirectionProvider.tsx`:

```typescript
'use client';

import { useLocale } from 'next-intl';
import { useEffect } from 'react';

const rtlLocales = ['ar'];

export function DirectionProvider({ children }: { children: React.ReactNode }) {
  const locale = useLocale();
  const isRTL = rtlLocales.includes(locale);

  useEffect(() => {
    document.documentElement.dir = isRTL ? 'rtl' : 'ltr';
    document.documentElement.lang = locale;
  }, [locale, isRTL]);

  return <>{children}</>;
}
```

Update `src/app/globals.css` for RTL:

```css
/* RTL Support */
[dir="rtl"] {
  text-align: right;
}

[dir="rtl"] .space-x-2 > :not([hidden]) ~ :not([hidden]) {
  --tw-space-x-reverse: 1;
}

[dir="rtl"] .ml-2 {
  margin-left: 0;
  margin-right: 0.5rem;
}

[dir="rtl"] .mr-2 {
  margin-right: 0;
  margin-left: 0.5rem;
}

[dir="rtl"] .pl-4 {
  padding-left: 0;
  padding-right: 1rem;
}

[dir="rtl"] .pr-4 {
  padding-right: 0;
  padding-left: 1rem;
}

/* Flip icons in RTL */
[dir="rtl"] .rtl-flip {
  transform: scaleX(-1);
}
```

### Step 7: Update Layout

Update `src/app/layout.tsx`:

```typescript
import { getLocale, getMessages } from 'next-intl/server';
import { LanguageProvider } from '@/components/providers/LanguageProvider';
import { DirectionProvider } from '@/components/providers/DirectionProvider';

export default async function RootLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  const locale = await getLocale();
  const messages = await getMessages();

  return (
    <html lang={locale} suppressHydrationWarning>
      <body>
        <LanguageProvider locale={locale} messages={messages}>
          <DirectionProvider>
            {/* ... rest of providers */}
            {children}
          </DirectionProvider>
        </LanguageProvider>
      </body>
    </html>
  );
}
```

### Step 8: Update Components to Use Translations

Example update for `src/components/email/EmailValidator.tsx`:

```typescript
'use client';

import { useTranslations } from 'next-intl';

export function EmailValidator() {
  const t = useTranslations('home');
  const tValidation = useTranslations('validation');
  const tErrors = useTranslations('errors');

  return (
    <div>
      <h1>{t('title')}</h1>
      <p>{t('subtitle')}</p>

      <input
        placeholder={t('placeholder')}
        // ...
      />

      <button>
        {isValidating ? t('validating') : t('validateButton')}
      </button>

      {/* Validation result */}
      {result && (
        <div>
          <span>{tValidation('score')}: {result.score}</span>
          <span>{tValidation('deliverability')}: {tValidation(result.deliverability)}</span>
        </div>
      )}
    </div>
  );
}
```

### Step 9: Update Navigation

Update `src/components/layout/Header.tsx`:

```typescript
'use client';

import { useTranslations } from 'next-intl';
import { LanguageSwitcher } from '@/components/language/LanguageSwitcher';

export function Header() {
  const t = useTranslations('nav');

  return (
    <header>
      <nav>
        <Link href="/">{t('home')}</Link>
        <Link href="/bulk">{t('bulk')}</Link>
        <Link href="/history">{t('history')}</Link>
        <Link href="/api-docs">{t('apiDocs')}</Link>
      </nav>
      <LanguageSwitcher />
    </header>
  );
}
```

### Step 10: Write Tests

Create `src/__tests__/i18n/i18n.test.tsx`:

```typescript
import { render, screen, fireEvent } from '@testing-library/react';
import { NextIntlClientProvider } from 'next-intl';
import { LanguageSwitcher } from '@/components/language/LanguageSwitcher';
import enMessages from '../../../messages/en.json';
import arMessages from '../../../messages/ar.json';

const renderWithIntl = (ui: React.ReactElement, locale = 'en') => {
  const messages = locale === 'en' ? enMessages : arMessages;

  return render(
    <NextIntlClientProvider locale={locale} messages={messages}>
      {ui}
    </NextIntlClientProvider>
  );
};

describe('Internationalization', () => {
  describe('LanguageSwitcher', () => {
    test('renders language switcher', () => {
      renderWithIntl(<LanguageSwitcher />);

      expect(screen.getByRole('button')).toBeInTheDocument();
    });
  });

  describe('Translations', () => {
    test('English translations are complete', () => {
      expect(enMessages.common.appName).toBe('Email Validator');
      expect(enMessages.home.title).toBe('Email Validator');
      expect(enMessages.nav.home).toBe('Home');
    });

    test('Arabic translations are complete', () => {
      expect(arMessages.common.appName).toBe('مدقق البريد الإلكتروني');
      expect(arMessages.home.title).toBe('مدقق البريد الإلكتروني');
      expect(arMessages.nav.home).toBe('الرئيسية');
    });

    test('All translation keys match', () => {
      const getKeys = (obj: any, prefix = ''): string[] => {
        return Object.entries(obj).flatMap(([key, value]) => {
          const newKey = prefix ? `${prefix}.${key}` : key;
          if (typeof value === 'object' && value !== null) {
            return getKeys(value, newKey);
          }
          return [newKey];
        });
      };

      const enKeys = getKeys(enMessages);
      const arKeys = getKeys(arMessages);

      expect(enKeys.sort()).toEqual(arKeys.sort());
    });
  });
});
```

---

## Completion Checklist

```
[ ] next-intl installed
[ ] English translations complete
[ ] Arabic translations complete
[ ] i18n configuration created
[ ] Middleware configured
[ ] LanguageProvider created
[ ] LanguageSwitcher component
[ ] DirectionProvider for RTL
[ ] RTL CSS styles added
[ ] Layout updated with providers
[ ] Home page translated
[ ] Bulk page translated
[ ] History page translated
[ ] API docs page translated
[ ] Header/Footer translated
[ ] Validation messages translated
[ ] Error messages translated
[ ] Language preference persisted
[ ] Tests written and passing
[ ] All existing tests pass
[ ] Changes committed and pushed
```

---

## Next Milestone

After completing this milestone, proceed to:
`plans/milestones/9.3-keyboard-shortcuts.md`
