# Milestone 6.3: Postman Collection

> **Phase:** 6 - DevOps & Deployment
> **Status:** COMPLETED
> **Priority:** LOW
> **Complexity:** Low
> **Estimated Time:** 1-2 hours

---

## Prompt for Claude Code

```
You are working on the Email Validator project. Your task is to create a Postman collection for API testing.

IMPORTANT INSTRUCTIONS:
1. Read this entire file before starting
2. Create the Postman collection JSON file
3. Include all API endpoints with examples
4. Add environment variables configuration
5. Add pre-request and test scripts
6. Update the checklist as you complete each task
7. Commit with message: "docs: add Postman collection for API testing"
8. Push the changes

API ENDPOINTS TO DOCUMENT:
- POST /api/validate - Single email validation
- POST /api/validate-bulk - Bulk email validation
- GET /api/health - Health check
- POST /api/csp-report - CSP violation reporting
```

---

## Objective

Create a comprehensive Postman collection that:
- Documents all API endpoints
- Includes example requests and responses
- Has environment variables for different environments
- Contains pre-request scripts for authentication
- Contains test scripts for response validation

---

## Implementation Steps

### Step 1: Create Postman Collection

Create `docs/postman/Email-Validator-API.postman_collection.json`:

```json
{
  "info": {
    "name": "Email Validator API",
    "description": "Complete API collection for the Email Validator service.\n\n## Features\n- Single email validation\n- Bulk email validation\n- Health checks\n\n## Authentication\nSet the `api_key` environment variable to use API key authentication.",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "version": "1.0.0"
  },
  "auth": {
    "type": "apikey",
    "apikey": [
      {
        "key": "key",
        "value": "X-API-Key",
        "type": "string"
      },
      {
        "key": "value",
        "value": "{{api_key}}",
        "type": "string"
      },
      {
        "key": "in",
        "value": "header",
        "type": "string"
      }
    ]
  },
  "item": [
    {
      "name": "Validation",
      "description": "Email validation endpoints",
      "item": [
        {
          "name": "Validate Single Email",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"test@gmail.com\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{base_url}}/api/validate",
              "host": ["{{base_url}}"],
              "path": ["api", "validate"]
            },
            "description": "Validate a single email address.\n\n**Response Fields:**\n- `email`: The validated email\n- `isValid`: Boolean validation result\n- `score`: Quality score (0-100)\n- `deliverability`: deliverable | risky | undeliverable | unknown\n- `risk`: low | medium | high\n- `checks`: Detailed validation checks"
          },
          "response": [
            {
              "name": "Valid Email",
              "status": "OK",
              "code": 200,
              "body": "{\n  \"email\": \"test@gmail.com\",\n  \"isValid\": true,\n  \"score\": 95,\n  \"deliverability\": \"deliverable\",\n  \"risk\": \"low\",\n  \"checks\": {\n    \"syntax\": {\"valid\": true, \"message\": \"Email syntax is valid\"},\n    \"domain\": {\"valid\": true, \"exists\": true},\n    \"mx\": {\"valid\": true, \"records\": [\"alt1.gmail-smtp-in.l.google.com\"]},\n    \"disposable\": {\"isDisposable\": false},\n    \"roleBased\": {\"isRoleBased\": false},\n    \"freeProvider\": {\"isFree\": true, \"provider\": \"Gmail\"},\n    \"typo\": {\"hasTypo\": false}\n  },\n  \"timestamp\": \"2025-01-15T10:00:00.000Z\"\n}"
            },
            {
              "name": "Invalid Email",
              "status": "OK",
              "code": 200,
              "body": "{\n  \"email\": \"invalid\",\n  \"isValid\": false,\n  \"score\": 0,\n  \"deliverability\": \"undeliverable\",\n  \"risk\": \"high\",\n  \"checks\": {\n    \"syntax\": {\"valid\": false, \"message\": \"Invalid email format\"}\n  }\n}"
            }
          ],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response has required fields', function () {",
                  "    const json = pm.response.json();",
                  "    pm.expect(json).to.have.property('email');",
                  "    pm.expect(json).to.have.property('isValid');",
                  "    pm.expect(json).to.have.property('score');",
                  "    pm.expect(json).to.have.property('deliverability');",
                  "    pm.expect(json).to.have.property('risk');",
                  "    pm.expect(json).to.have.property('checks');",
                  "});",
                  "",
                  "pm.test('Score is between 0 and 100', function () {",
                  "    const json = pm.response.json();",
                  "    pm.expect(json.score).to.be.at.least(0);",
                  "    pm.expect(json.score).to.be.at.most(100);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Validate Disposable Email",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"test@tempmail.com\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/validate",
              "host": ["{{base_url}}"],
              "path": ["api", "validate"]
            },
            "description": "Example of validating a disposable email address."
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Detects disposable email', function () {",
                  "    const json = pm.response.json();",
                  "    pm.expect(json.checks.disposable.isDisposable).to.be.true;",
                  "    pm.expect(json.risk).to.equal('high');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Validate with Typo",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"test@gmial.com\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/validate",
              "host": ["{{base_url}}"],
              "path": ["api", "validate"]
            },
            "description": "Example showing typo detection (gmial.com -> gmail.com)."
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Detects typo and suggests correction', function () {",
                  "    const json = pm.response.json();",
                  "    pm.expect(json.checks.typo.hasTypo).to.be.true;",
                  "    pm.expect(json.checks.typo.suggestion).to.equal('gmail.com');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Bulk Validate Emails",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"emails\": [\n    \"test1@gmail.com\",\n    \"test2@yahoo.com\",\n    \"invalid-email\",\n    \"test@tempmail.com\"\n  ]\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/validate-bulk",
              "host": ["{{base_url}}"],
              "path": ["api", "validate-bulk"]
            },
            "description": "Validate multiple email addresses in a single request.\n\n**Limits:**\n- Maximum 1000 emails per request\n- Rate limited based on API key tier"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Returns results array', function () {",
                  "    const json = pm.response.json();",
                  "    pm.expect(json).to.have.property('results');",
                  "    pm.expect(json.results).to.be.an('array');",
                  "    pm.expect(json.results.length).to.equal(4);",
                  "});",
                  "",
                  "pm.test('Returns metadata', function () {",
                  "    const json = pm.response.json();",
                  "    pm.expect(json).to.have.property('metadata');",
                  "    pm.expect(json.metadata).to.have.property('total');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        }
      ]
    },
    {
      "name": "System",
      "description": "System and health endpoints",
      "item": [
        {
          "name": "Health Check",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/health",
              "host": ["{{base_url}}"],
              "path": ["api", "health"]
            },
            "description": "Check API health status and get system information."
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Health status is healthy', function () {",
                  "    const json = pm.response.json();",
                  "    pm.expect(json.status).to.equal('healthy');",
                  "});",
                  "",
                  "pm.test('Response time is acceptable', function () {",
                  "    pm.expect(pm.response.responseTime).to.be.below(1000);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        }
      ]
    },
    {
      "name": "Error Handling",
      "description": "Examples of error responses",
      "item": [
        {
          "name": "Missing Email Field",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{}"
            },
            "url": {
              "raw": "{{base_url}}/api/validate",
              "host": ["{{base_url}}"],
              "path": ["api", "validate"]
            },
            "description": "Example of error response when email field is missing."
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Returns 400 Bad Request', function () {",
                  "    pm.response.to.have.status(400);",
                  "});",
                  "",
                  "pm.test('Returns error message', function () {",
                  "    const json = pm.response.json();",
                  "    pm.expect(json).to.have.property('error');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Rate Limit Exceeded",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"test@example.com\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/validate",
              "host": ["{{base_url}}"],
              "path": ["api", "validate"]
            },
            "description": "When rate limit is exceeded, returns 429 with Retry-After header."
          },
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "exec": [
                  "// This test intentionally triggers rate limiting",
                  "// Run this multiple times quickly to see rate limit response"
                ],
                "type": "text/javascript"
              }
            }
          ]
        }
      ]
    }
  ],
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// Add timestamp to requests for debugging",
          "pm.request.headers.add({",
          "    key: 'X-Request-Time',",
          "    value: new Date().toISOString()",
          "});"
        ]
      }
    },
    {
      "listen": "test",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// Log response time for all requests",
          "console.log('Response time: ' + pm.response.responseTime + 'ms');"
        ]
      }
    }
  ],
  "variable": [
    {
      "key": "base_url",
      "value": "http://localhost:3000",
      "type": "string"
    }
  ]
}
```

### Step 2: Create Environment Files

Create `docs/postman/environments/local.postman_environment.json`:

```json
{
  "id": "local-env",
  "name": "Email Validator - Local",
  "values": [
    {
      "key": "base_url",
      "value": "http://localhost:3000",
      "type": "default",
      "enabled": true
    },
    {
      "key": "api_key",
      "value": "",
      "type": "secret",
      "enabled": true
    }
  ],
  "_postman_variable_scope": "environment"
}
```

Create `docs/postman/environments/production.postman_environment.json`:

```json
{
  "id": "prod-env",
  "name": "Email Validator - Production",
  "values": [
    {
      "key": "base_url",
      "value": "https://your-domain.com",
      "type": "default",
      "enabled": true
    },
    {
      "key": "api_key",
      "value": "",
      "type": "secret",
      "enabled": true
    }
  ],
  "_postman_variable_scope": "environment"
}
```

### Step 3: Create README

Create `docs/postman/README.md`:

```markdown
# Postman Collection

This directory contains the Postman collection and environments for testing the Email Validator API.

## Quick Start

1. **Import Collection:**
   - Open Postman
   - Click "Import" button
   - Select `Email-Validator-API.postman_collection.json`

2. **Import Environment:**
   - Click "Import" button
   - Select an environment from `environments/` folder

3. **Set API Key (if required):**
   - Select your environment
   - Set the `api_key` variable

4. **Start Testing:**
   - Select a request from the collection
   - Click "Send"

## Collection Structure

```
Email Validator API/
├── Validation/
│   ├── Validate Single Email
│   ├── Validate Disposable Email
│   ├── Validate with Typo
│   └── Bulk Validate Emails
├── System/
│   └── Health Check
└── Error Handling/
    ├── Missing Email Field
    └── Rate Limit Exceeded
```

## Environments

| Environment | Base URL | Description |
|-------------|----------|-------------|
| Local | http://localhost:3000 | Local development |
| Production | https://your-domain.com | Production server |

## Test Scripts

Each request includes test scripts that validate:
- Response status codes
- Response structure
- Required fields
- Business logic (e.g., typo detection)

Run all tests: **Collection > Run Collection**

## Variables

| Variable | Description | Example |
|----------|-------------|---------|
| `base_url` | API base URL | http://localhost:3000 |
| `api_key` | API authentication key | your-api-key |

## Rate Limits

| Tier | Limit |
|------|-------|
| Anonymous | 20 req/min |
| Free | 100 req/min |
| Pro | 1000 req/min |
| Enterprise | 10000 req/min |
```

---

## Completion Checklist

```
[x] Collection JSON created
[x] All endpoints documented (12 requests)
[x] Example requests included
[x] Example responses included
[x] Test scripts added
[x] Pre-request scripts added
[x] Local environment created
[x] Production environment created
[x] Docker environment created
[x] README documentation created
[x] Collection JSON validated
[x] Changes committed and pushed
```

---

## Next Milestone

After completing this milestone, proceed to:
`plans/milestones/7.1-smtp-verification.md`
